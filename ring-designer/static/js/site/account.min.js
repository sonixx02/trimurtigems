var stopPropagate=function(a){a.stopPropagation()};$(".fullsize-shadow").click(function(){$(this).fadeOut()});$(".close-btn").click(function(){window.hidePopUp&&window.hidePopUp()});$(".popup").click(stopPropagate);var showRegisterPopup=function(){hidePopUp();$("#register-popup-display").fadeIn();return!1};$(".inscription-trigger").off("click").click(showRegisterPopup);var showConnectPopup=function(){hidePopUp();$("#connect-popup-display").fadeIn();return!1};$(".connection-trigger").off("click").click(showConnectPopup);
$("#to-connect-trigger").off("click").click(function(){hidePopUp();$("#connect-popup-display").fadeIn();var a=""+$("#register-email").val(),b=""+$("#register-password").val();void 0!==a&&(""!==a&&void 0!==b&&""!==b)&&($("#login-email").val(a),$("#login-password").val(b))});$("#to-register-trigger").off("click").click(function(){hidePopUp();$("#register-popup-display").fadeIn();var a=""+$("#login-email").val();void 0!==a&&""!==a&&$("#register-email").val(a)});
$("#reset-popup-trigger").off("click").click(function(){hidePopUp();$("#reset-popup-display").fadeIn()});$("#disconnect-trigger").click(function(){logout()});
var hidePopUp=function(){$(".fullsize-shadow").fadeOut();$(".error").hide()},email_exists=function(a){return!1},username_exists=function(a){return!1},process_login=function(a){hidePopUp();$("#username-display").html(a.username);$(".account-dropdown .img-profile").attr("src",window.media+"/"+a.avatar);$("#menu-unsigned").fadeOut(0,function(){window.cartData.refresh();$("#menu-signed").fadeIn(300);a.admin&&$("#admin-menu").show();if(window.onLogin)window.onLogin()})},process_register=function(a){hidePopUp();
$("#username-display").html(a.username);$(".account-dropdown .img-profile").attr("src",window.media+"/"+a.avatar);$("#menu-unsigned").fadeOut(0,function(){window.cartData.refresh();$("#menu-signed").fadeIn(300);a.admin&&$("#admin-menu").show();if(window.onRegister)window.onRegister()})},process_logout=function(){hidePopUp();$("#menu-signed").fadeOut(0,function(){$("#menu-unsigned").fadeIn(300);if(window.onLogout)window.onLogout();else window.location.replace(window.base_lang_url)})},process_login_error=
function(a){$("#connect-popup-display .error").text(a).fadeIn()},process_register_error=function(a){$("#register-popup-display .error").fadeIn();$("#register-popup-display .error").text(a)},login=function(a){a=$("#login-email").val();var b=$("#login-password").val();$.ajax({type:"POST",data:"email="+a+"&password="+b,dataType:"json",contentType:"application/x-www-form-urlencoded",url:window.media+"/u/login/",success:function(a){process_login(a);_track.evt("login")},error:function(a,b,d){process_login_error(gettext("login ou mot de passe incorrect"))}});
return!1},logout=function(){console.log("logout");$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:window.media+"/u/logout/",success:function(a){process_logout()},error:function(a,b,c){window.userMsgs.defaultError()}});return!1},register=function(){var a=$("#register-email").val(),b=$("#register-password").val();return jweel_reg(a,b)},jweel_reg=function(a,b){$.ajax({type:"POST",data:"email="+a+"&password="+b,dataType:"json",contentType:"application/x-www-form-urlencoded",url:window.media+
"/u/register/",success:function(a){process_register(a);$("#register-form-trigger").attr("disabled",!1);_track.evt("registered")},error:function(a,b,d){$("#register-form-trigger").attr("disabled",!1);switch(a.status){case 400:process_register_error(gettext("Email ou password incorrect."));break;case 401:$("#to-connect-trigger").fadeIn();process_register_error(gettext("Votre e-mail est déjà associé a un compte."));break;default:process_register_error(gettext("Une erreur a eu lieu durant l'enregistrement."))}}});
return!1},reset=function(){var a=$("#reset-email").val();$.ajax({type:"POST",data:"&email="+a,contentType:"application/x-www-form-urlencoded",url:window.media+"/u/sendreset/",success:function(a){bootbox.alert(gettext("Un mail de réinitialisation vous a été envoyé."));hidePopUp()},error:function(a,c,e){404==a.status?window.userMsgs.customErrorMsg(gettext("Désolé, cette addresse mail ne correspond à aucun compte enregistré.")):window.defaultError()}});return!1};
